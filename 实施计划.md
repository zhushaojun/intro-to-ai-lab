## 总体安排（通用）

- **课时**: 每个实验 2 学时（90 分钟），以“照做可成”为目标。
- **平台**: Windows 10 + cmd，Python 3.12。
- **pip 镜像**: 统一使用清华源；安装 PyTorch 时临时改用官方 CPU 源。
- **执行方式**: 学生只需运行给定命令/脚本；如需改参数/模型，必须提供可复制命令或代码。
 - **教学法**: 简单模型优先；所有代码包含详细中文注释；思考题简单有趣、贴近直觉。

### 虚拟环境（共用一次即可）

```bat
python -m venv .venv
\.venv\Scripts\activate.bat
pip config set global.index-url https://pypi.tuna.tsinghua.edu.cn/simple
pip config set global.trusted-host pypi.tuna.tsinghua.edu.cn
pip install -U pip setuptools wheel
```

### 常用依赖（实验 1/2）

```bat
pip install numpy pandas scikit-learn matplotlib seaborn
```

### PyTorch CPU 版（仅实验 3；使用官方 CPU 源）

```bat
pip install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cpu
```

### 提交物（每个实验）

- PDF 实验报告：目标、步骤截图、关键输出、结果解读、思考题。
- 输出文件：指标表（CSV/截图）、图像文件（PNG）、模型文件（如有）。
- 可选：命令历史或运行日志。


## 实验一：scikit-learn 入门与线性回归

### 目标

- 用最简单的线性回归（LinearRegression）完成“数据→切分→训练→评估→保存”的完整流程。
- 会读取与解释 MAE/MSE/R² 等指标，理解其直观意义。
- 脚本包含详细中文注释，学生按步骤执行即可（仅可改命令参数）。

### 数据

- `sklearn.datasets` 加州房价（California Housing）或糖尿病（Diabetes）。

### 时间分配（90 分钟）

- 10m 目标与流程讲解
- 10m 环境核查与依赖安装
- 50m 主任务执行（含结果解读）
- 15m 结果分析与思考题
- 5m 收尾与提交说明

### 主任务清单（默认无需改代码，仅运行脚本/命令）

1. 数据加载与简单可视化（可选）。
2. 切分训练/测试集：`train_test_split`（默认 8:2）。
3. 训练线性回归模型：`LinearRegression`（无需调参）。
4. 评估并导出指标：MAE/MSE/R²（保存 CSV）。
5. 绘图：真实值 vs 预测值散点图、残差分布图（保存 PNG）。
6. 保存模型（joblib）并可选加载验证。

### 可变参数（提供可复制命令）

- 训练/测试切分比例 `test_size`（如 0.2 / 0.3）。
- 随机种子 `--seed`（确保可复现）。

示例（脚本 `exp1_linear_regression.py`）：

```bat
python exp1_linear_regression.py --out-dir outputs --test-size 0.2 --seed 42
```

### 预期输出

- 指标表（CSV/控制台表格），两幅图（散点/残差），模型文件（.joblib）。

### 思考题（示例）

- 为什么要保留一部分数据做“测试集”？如果测试集太小会怎样？
- 看散点图时，远离参考线 y=x 的点在现实中意味着什么（例如异常情况）？
- 不调参的最简单线性回归能解决哪些问题？又可能在哪些场景力不从心？

### 排错要点

- 图形不显示：使用 `plt.savefig("xxx.png")` 并在报告插图。
- 版本冲突：`pip show scikit-learn` 确认版本，必要时 `pip install -U scikit-learn`。


## 实验二：机器学习之无监督学习

### 目标

- 掌握 KMeans 聚类、PCA 可视化与评估（轮廓系数 Silhouette）。
- 理解聚类数 k 的影响与特征缩放的必要性。

### 数据

- `sklearn.datasets` Iris（低维好可视化）与 Digits（高维，用 PCA 到 2D）。

### 时间分配（90 分钟）

- 10m 无监督学习概念与评估指标
- 10m 环境核查
- 50m 主任务执行（含 k 的选择）
- 15m 结果分析与思考题
- 5m 收尾与提交说明

### 主任务清单

1. 加载数据并 `StandardScaler`。
2. KMeans 聚类（k=2..8 扫描），记录 `inertia` 与 `silhouette_score`。
3. 用 PCA 将特征降到 2D，绘制聚类散点（不同簇不同颜色）。
4. 对 `Iris` 用标签（已知类别）对照：计算聚类标签与真实标签的对齐度（如 ARI/NMI）。
5. 选择最优 k 的依据（肘部法 + 轮廓系数）并给出可视化。

### 可变参数（提供命令）

- `k` 范围、随机种子、最大迭代次数。

示例（假定脚本 `exp2_unsupervised.py`）：

```bat
python exp2_unsupervised.py --dataset iris --k-range 2 8 --seed 42 --max-iter 300
python exp2_unsupervised.py --dataset digits --k-range 2 12 --seed 42 --max-iter 300
```

### 预期输出

- k-指标曲线图（inertia/轮廓系数），PCA 2D 聚类图，表格汇总（最佳 k 与分数）。

### 思考题（示例）

- 为什么标准化能显著影响 KMeans 结果？
- 当类簇非球形或大小差异大时，KMeans 会出现什么问题？

### 排错要点

- `silhouette_score` 失败：确认 k ≥ 2 且样本数 > k。
- 可视化混乱：检查 PCA 是否在缩放后执行，并设置固定随机种子。


## 实验三：深度学习之图像识别 CNN（PyTorch CPU）

### 目标

- 了解 CNN 基本结构与前向传播；会训练、验证、保存与加载模型。
- 在 CPU 上对 MNIST 进行 1–2 个 epoch 训练，达成 >95% 准确率（参考）。

### 数据

- `torchvision.datasets.MNIST` 自动下载；保存到 `./data`。

### 时间分配（90 分钟）

- 10m CNN 与训练流程讲解
- 10m 依赖安装（PyTorch CPU 源）
- 55m 训练与评估（含一次参数变体）
- 10m 结果分析与思考题
- 5m 收尾与提交说明

### 安装与检查

```bat
pip install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cpu
python -c "import torch;print(torch.__version__, 'cuda?' ,torch.cuda.is_available())"
```

### 主任务清单

1. 定义轻量 CNN（两层卷积+两层全连接），使用 `CrossEntropyLoss`、`Adam`。
2. 训练 1–2 个 epoch（CPU），记录训练/验证准确率与损失。
3. 保存最优模型 `mnist_cnn.pth`；提供单独推理脚本对若干样本预测并保存可视化图。

### 可变参数（提供命令）

- `--epochs`、`--batch-size`、`--lr`；可切换 `SGD` 与 `Adam`。

示例（假定脚本 `exp3_cnn_mnist.py` / `exp3_infer.py`）：

```bat
python exp3_cnn_mnist.py --epochs 2 --batch-size 128 --lr 0.001 --optimizer adam --data-dir .\data --out-dir .\outputs
python exp3_infer.py --ckpt .\outputs\mnist_cnn.pth --num-samples 16 --out .\outputs\pred_grid.png
```

### 预期输出

- 训练日志（每 epoch 的 loss/acc）、最终验证准确率、推理结果图 `pred_grid.png`、模型文件。

### 思考题（示例）

- 卷积核大小/步幅对感受野与计算量的影响？
- 为什么批归一化或数据增强对泛化有效？

### 排错要点

- 下载数据失败：更换网络或预下好 MNIST，放到 `.\data\MNIST\raw`。
- 训练慢：减小 `batch-size` 或只跑 1 个 epoch；确保未意外使用 `num_workers>0` 在某些环境下造成阻塞。
- 导入失败：确认安装命令使用了 PyTorch CPU 官方源命令（不是清华镜像）。


## 评分建议（统一）

- **准确性 40%**: 指标达成与结果解释到位（回归/聚类/分类）。
- **完整性 30%**: 步骤执行齐全、截图充分、输出文件完整。
- **表达 20%**: 报告结构清晰、图表规范、术语使用正确。
- **规范 10%**: 命令与代码可复制，环境一致（Win10+cmd），文件命名合规。


## 物料清单（教师侧准备）

- `exp1_linear_regression.py`：最简单线性回归；保存图与 `metrics.csv`，保存模型（.joblib）。
- `exp2_unsupervised.py`：支持数据选择、k 扫描、PCA 可视化、导出曲线与聚类图。
- `exp3_cnn_mnist.py` / `exp3_infer.py`：训练、保存、推理与可视化。
- 示例数据与输出样例：图像、CSV、日志，供学生对照。
- 课前检查脚本：验证 Python 版本、依赖、写权限、网络连通性。

